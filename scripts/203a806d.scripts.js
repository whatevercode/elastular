"use strict";angular.module("elastularApp",["elasticjs.service","ui.ace"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/search",{templateUrl:"views/search.html",controller:"SearchCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("elastularApp").controller("MainCtrl",["$scope","ejsResource",function(a,b){a.url="",a.getClusterStats=function(){console.log("get cluster stats...",new Date),ejs.ClusterState().doState(function(b){console.log("stats",b),a.stats=b,a.statsJson=JSON.stringify(b.nodes,null,4),a.indicesJson=JSON.stringify(b.metadata.indices,null,4)})},a.connect=function(){a.stats=void 0,a.statsJson="{}",a.indicesJson="{}",console.log("connection...",a.url),a.ejs=b(a.url),a.getClusterStats()},""!==a.url&&a.connect(),a.$watch("url",a.connect,!0),a.showIndexInfo=function(b,c){a.indexInfo={index:b,data:c}},a.request=ejs.Request(),a.request.query(ejs.MatchAllQuery()),a.doSearch=function(){a.request.doSearch(function(b){console.log("search res",b),a.results=b})},a.doSearch(),a.resultsJson="{}",a.addTypeFilter=function(){a.request.filter(ejs.TypeFilter("tackls")),a.doSearch()}}]),angular.module("elastularApp").controller("SearchCtrl",["$scope","ejsResource",function($scope,ejsResource){function getParamNames(a){var b=a.toString();return b.slice(b.indexOf("(")+1,b.indexOf(")")).match(/([^\s,]+)/g)}function setEjsRequestStr(){console.log("$scope.request.toString()",$scope.request.toString()),$scope.ejsRequestStr=jsonString(JSON.parse($scope.request.toString())),0===$scope.queryErrors.length&&$scope.doSearch()}function jsonString(a){return JSON.stringify(a,null,4)}$scope.queryErrors=[],$scope.filterErrors=[],$scope.facetErrors=[],$scope.queryEjs="ejs.MatchAllQuery();",$scope.filterEjs="",$scope.facetEjs="";var _editor=$scope.foo;console.log("editor",_editor),$scope.request=ejs.Request(),$scope.doSearch=function(){$scope.results=void 0,$scope.resultsJson=JSON.stringify({},null,4),$scope.request.doSearch(function(a){console.log("search res",a),$scope.results=a,$scope.resultsJson=JSON.stringify(a,null,4)})},$scope.url="",$scope.connect=function(){console.log("connection...",$scope.url),$scope.ejs=ejsResource($scope.url),$scope.doSearch()},""!==$scope.url&&$scope.connect(),$scope.$watch("url",$scope.connect,!0),$scope.addTypeFilter=function(){$scope.request.filter(ejs.TypeFilter("tackls")),$scope.doSearch()},$scope.add=function(a,b){console.log("adding",a);var c=getParamNames(b);c=c||[];var d=c.join(",");console.log("params: ",c,d),a.indexOf("Query")>0?(console.log("is a query"),angular.isFunction(b)&&(console.log("v",Object.keys(b)),$scope.queryEjs=($scope.queryEjs?$scope.queryEjs:"")+"ejs."+a+"("+d+");\n"),void 0===$scope.request.query()&&console.log("adding first query...")):a.indexOf("Filter")>0?($scope.filterEjs=($scope.filterEjs?$scope.filterEjs:"")+"ejs."+a+"("+d+");\n",$scope.filterStr=jsonString(b()),console.log("is a Filter")):a.indexOf("Facet")>0?($scope.facetEjs=($scope.facetEjs?$scope.facetEjs+"\n":"")+"ejs."+a+"("+d+");",console.log("is a Facet")):console.log("else",a),setEjsRequestStr()},$scope.show=function(a,b){console.log("show",a,b())},$scope.execFilterEjs=function(type){console.log("execFilterEjs!!"),$scope.filterErrors=[];try{console.log("execEjs",type,$scope.filterEjs,eval($scope.filterEjs))}catch(err){console.error("exception!!!",err.message),$scope.filterErrors.push(err.message)}$scope.request.filter(eval($scope.filterEjs)),setEjsRequestStr()},$scope.$watch("filterEjs",$scope.execFilterEjs,!0),$scope.execQueryEjs=function(){$scope.queryErrors=[];try{console.log("execQueryEjs",$scope.queryEjs,eval($scope.queryEjs))}catch(err){console.error("exception!!!",err.message),$scope.queryErrors.push(err.message)}$scope.request.query(eval($scope.queryEjs)),setEjsRequestStr()},$scope.$watch("queryEjs",$scope.execQueryEjs,!0),$scope.setFacet=function(){console.log("setFacet"),$scope.request.facet(eval($scope.facetEjs)),setEjsRequestStr()},$scope.execFacetEjs=function(){$scope.facetErrors=[];try{console.log("execFacetEjs",$scope.facetEjs,eval($scope.facetEjs))}catch(err){console.error("exception!!!",err.message),$scope.facetErrors.push(err.message)}},$scope.$watch("facetEjs",$scope.execFacetEjs,!0)}]),angular.module("elastularApp").filter("funcParams",function(){function a(a){var b=a.toString();return b.slice(b.indexOf("(")+1,b.indexOf(")")).match(/([^\s,]+)/g)}return function(b){return a(b)}});